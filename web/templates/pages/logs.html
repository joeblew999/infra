<!DOCTYPE html>
<html lang="en">
<head>
    <title>Logs - Infrastructure Management</title>
    {{.Header}}
    {{.DataStar}}
</head>
<body class="bg-white dark:bg-gray-900 text-base sm:text-lg max-w-4xl mx-auto px-4 sm:px-6 py-4 sm:py-8">
    {{.Navigation}}
    <div class="bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 sm:px-6 py-4 sm:py-8 ring shadow-xl ring-gray-900/5">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-semibold">üìù System Logs</h2>
            <div class="flex items-center space-x-4">
                <div class="text-sm text-gray-500 dark:text-gray-400" id="last-updated">
                    Last updated: Loading...
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-sm text-green-600 dark:text-green-400">Live</span>
                </div>
            </div>
        </div>
        
        <!-- Log Controls -->
        <div class="mb-4 flex flex-wrap items-center gap-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <div class="flex items-center space-x-2">
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Level:</label>
                <select class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                    <option value="all">All</option>
                    <option value="error">Error</option>
                    <option value="warn">Warning</option>
                    <option value="info" selected>Info</option>
                    <option value="debug">Debug</option>
                </select>
            </div>
            <div class="flex items-center space-x-2">
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Source:</label>
                <select class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                    <option value="all">All Sources</option>
                    <option value="web">Web Server</option>
                    <option value="system">System</option>
                    <option value="nats">NATS</option>
                    <option value="goreman">Process Manager</option>
                </select>
            </div>
            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-md transition-colors duration-200"
                    data-on-click="$$get('/api/logs/stream')">
                üîÑ Refresh
            </button>
            <button class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm rounded-md transition-colors duration-200">
                üìã Export
            </button>
        </div>
        
        <!-- Log Stream Container -->
        <div class="space-y-2 max-h-96 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-4 bg-gray-50 dark:bg-gray-900" 
             data-on-load="$$get('/api/logs/stream')" id="log-container">
            <!-- Log entries will be populated here -->
            <div id="log-entries">
                <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-white mx-auto mb-2"></div>
                    Loading logs...
                </div>
            </div>
        </div>
        
        <!-- Log Statistics -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                <div class="text-sm text-red-600 dark:text-red-400 font-medium">Errors</div>
                <div class="text-2xl font-bold text-red-800 dark:text-red-200" id="error-count">0</div>
            </div>
            <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                <div class="text-sm text-yellow-600 dark:text-yellow-400 font-medium">Warnings</div>
                <div class="text-2xl font-bold text-yellow-800 dark:text-yellow-200" id="warn-count">0</div>
            </div>
            <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                <div class="text-sm text-blue-600 dark:text-blue-400 font-medium">Info</div>
                <div class="text-2xl font-bold text-blue-800 dark:text-blue-200" id="info-count">0</div>
            </div>
            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div class="text-sm text-gray-600 dark:text-gray-400 font-medium">Debug</div>
                <div class="text-2xl font-bold text-gray-800 dark:text-gray-200" id="debug-count">0</div>
            </div>
        </div>
        
        <!-- Auto-scroll toggle -->
        <div class="mt-4 flex justify-between items-center">
            <label class="flex items-center space-x-2 text-sm">
                <input type="checkbox" checked class="rounded border-gray-300 dark:border-gray-600" id="auto-scroll">
                <span class="text-gray-700 dark:text-gray-300">Auto-scroll to latest logs</span>
            </label>
            <div class="text-xs text-gray-500 dark:text-gray-400">
                Updates every 2 seconds ‚Ä¢ Max 100 entries
            </div>
        </div>
    </div>
    {{.Footer}}
    
    <script>
        // Auto-scroll functionality
        function scrollToBottom() {
            const container = document.getElementById('log-container');
            const autoScroll = document.getElementById('auto-scroll');
            if (container && autoScroll && autoScroll.checked) {
                container.scrollTop = container.scrollHeight;
            }
        }
        
        // Scroll to bottom when new logs arrive
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList' || mutation.type === 'subtree') {
                    scrollToBottom();
                }
            });
        });
        
        // Observe log entries for changes
        const logEntries = document.getElementById('log-entries');
        if (logEntries) {
            observer.observe(logEntries, { childList: true, subtree: true });
        }
        
        // Update last updated timestamp
        setInterval(() => {
            document.getElementById('last-updated').textContent = 
                `Last updated: ${new Date().toLocaleTimeString()}`;
        }, 2000);
    </script>
</body>
</html>