version: '3'

# Exclusions: This taskfile does not need to handle dep or dep:del tasks

vars:
  CLAUDE__BINARY_NAME: "claude"
  CLAUDE__BINARY_NAME_NATIVE: '{{.CLAUDE__BINARY_NAME}}{{if eq OS "windows"}}.exe{{end}}'
  CLAUDE__VERSION: "v1.15.0"


tasks:
  default:
    desc: List available CLAUDE tasks
    cmds:
      - echo
      - echo "Basic CLAUDE commands for reuse across projects"
      - echo
      - task --list-all
      - echo
    silent: true

  vars:
    desc: Show taskfile variables
    cmds:
      - cmd: |
          echo "CLAUDE__BINARY_NAME         {{.CLAUDE__BINARY_NAME}}"
          echo "CLAUDE__BINARY_NAME_NATIVE  {{.CLAUDE__BINARY_NAME_NATIVE}}"
          echo "CLAUDE__VERSION             {{.CLAUDE__VERSION}}"
    silent: true

### MCP: https://docs.anthropic.com/en/docs/claude-code/mcp

  mcp:start:
    desc: "Start CLAUDE MCP Server"
    cmds:
      - '{{.CLAUDE__BINARY_NAME_NATIVE}} mcp serve --verbose'

  mcp:add:
    desc: "Install many standard MCP to allow CLAUDE to interact with GitHub. Usage: task -d claude_taskfile.yml mcp:add"
    cmds:
      # GITHUB : https://github.com/github/github-mcp-server
      - '{{.CLAUDE__BINARY_NAME_NATIVE}} mcp add github npx @modelcontextprotocol/server-github'

      # Golang debuhgging: https://github.com/go-delve/mcp-dap-server
      # https://github.com/go-delve/mcp-dap-server?tab=readme-ov-file#example-configuration-using-claude-code
      #- go install github.com/go-delve/mcp-dap-server@latest
      #- mcp-dap-server
      #- '{{.CLAUDE__BINARY_NAME_NATIVE}} mcp add --transport sse mcp-dap-server http://localhost:8080'

      ## Playwright:  
      - '{{.CLAUDE__BINARY_NAME_NATIVE}} mcp add playwright npx @playwright/mcp@latest'
      

      - echo "MCP installed. Restart Claude Code to activate the GitHub tools."
  
  mcp:remove:
    desc: "remove installed CLAUDE MCP"
    cmds:
      - '{{.CLAUDE__BINARY_NAME_NATIVE}} mcp remove "github"'
      #- '{{.CLAUDE__BINARY_NAME_NATIVE}} mcp remove "mcp-dap-server"'
      - '{{.CLAUDE__BINARY_NAME_NATIVE}} mcp remove "playwright"'
  
  mcp:list:
    desc: "List installed CLAUDE MCPs"
    cmds:
      - '{{.CLAUDE__BINARY_NAME_NATIVE}} mcp list'
  mcp:get:
    desc: "List installed CLAUDE MCPs"
    cmds:
      - '{{.CLAUDE__BINARY_NAME_NATIVE}} mcp get github'
